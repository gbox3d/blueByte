# 음파 감지 펄스 생성기

고속 ADC 샘플링을 통한 음파 감지 및 펄스 출력 펌웨어

## 개요

이 펌웨어는 아날로그 센서(마이크)로부터 입력을 고속으로 샘플링하여 임계값 이상의 변화를 감지하면 즉시 디지털 핀을 통해 펄스 신호를 출력합니다. 위치 측정 시스템, 음향 센서 네트워크 등에 활용할 수 있습니다.

## 특징

- **고속 8비트 ADC 샘플링**: 최대 약 120,000 샘플/초 (8μs 시간 분해능)
- **최소 지연 감지**: 아날로그 값 변화 감지 즉시 펄스 출력
- **최적화된 코드**: 불필요한 오버헤드 제거 및 직접 포트 조작으로 속도 최적화
- **시간 분해능**: 약 8μs (음파 기준 약 2.8mm 거리 분해능)

## 하드웨어 요구 사항

- Arduino UNO, Nano 등 AVR 기반 보드 (ATmega328P)
- 아날로그 센서 (마이크 모듈, 압전 센서 등)
- 마스터 기기 (펄스 신호를 인터럽트로 받는 장치)

## 핀 연결

- **A0**: 아날로그 센서 입력 (마이크 모듈 출력)
- **D2**: 펄스 출력 (마스터 기기의 인터럽트 핀에 연결)

## 설정 변수

코드 최상단에서 다음 변수를 수정할 수 있습니다:

```cpp
const int threshold = 45;       // 임계값 설정 (감지 민감도)
const int pulsePin = 2;         // 펄스 출력용 디지털 핀
const int pulseDuration = 10;   // 펄스 지속 시간 (마이크로초)
```

## 사용 방법

1. 코드를 Arduino IDE로 열고 필요에 따라 설정 변수 수정
2. Arduino 보드에 업로드
3. 아날로그 센서를 A0 핀에 연결
4. 마스터 기기의 인터럽트 핀을 D2 핀에 연결
5. 전원 공급 및 동작 확인

## 여러 센서를 사용한 위치 측정

4개의 센서를 사용하여 2차원 위치 측정 시스템을 구성할 수 있습니다:

1. 각 센서에 이 펌웨어를 업로드 (동일한 임계값 사용 권장)
2. 모든 센서의 펄스 출력 핀을 마스터 기기의 각기 다른 인터럽트 핀에 연결
3. 마스터 기기에서 각 센서의 펄스 신호 타임스탬프를 기록
4. 센서 간 시간 차이를 계산하여 삼각측량으로 음원 위치 계산

## 성능 고려사항

- **해상도 vs 속도**: 8비트 해상도를 사용하여 속도를 최대화하였습니다.
- **임계값 설정**: 
  - 값이 너무 낮으면 노이즈에 의한 오탐지 증가
  - 값이 너무 높으면 실제 신호 감지 놓칠 가능성 있음
- **시간 분해능**: 8μs (120kHz 샘플링 속도 기준)
- **거리 분해능**: 약 2.8mm (음속 343m/s 기준)

## 코드 사용자 정의

다른 아두이노 보드를 사용할 경우 GPIO 포트 설정을 수정해야 할 수 있습니다:

```cpp
// 직접 포트 조작 부분 (Arduino UNO 기준, D2 핀은 PORTD의 비트 2)
PORTD |= (1 << pulsePin);  // HIGH 설정
PORTD &= ~(1 << pulsePin); // LOW 설정
```

## 제한 사항

- 한 번에 하나의 음원만 감지 가능
- 연속적인 음파보다는 임펄스성 음원(클릭, 탭, 충격음)에 더 적합
- 배경 소음이 많은 환경에서는 오탐지 가능성 있음
- 적절한 임계값 설정이 중요 (환경에 따라 조정 필요)

## 라이센스

이 펌웨어는 MIT 라이센스로 제공됩니다.